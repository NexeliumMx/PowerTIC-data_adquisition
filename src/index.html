<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Database Overview Test</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>
</head>
<body>
    <h1>Database Overview Test</h1>
    <div id="content"></div>

    <script>
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAf1j3sA2ASqtHpAfr5X5CITJFpnNc8zZA",
            authDomain: "project-mtpower.firebaseapp.com",
            databaseURL: "https://project-mtpower-default-rtdb.firebaseio.com",
            projectId: "project-mtpower",
            storageBucket: "project-mtpower.appspot.com",
            messagingSenderId: "416015446707",
            appId: "1:416015446707:web:c34018d26194b09484b6c6",
            measurementId: "G-CF9W5E2G6K"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();

        document.addEventListener('DOMContentLoaded', (event) => {
            const dbRef = firebase.database().ref('lecturas');

            dbRef.once('value', (snapshot) => {
                const jsonData = snapshot.val();
                const contentDiv = document.getElementById('content');

                // Extract the keys from the object lecturas
                const keys = Object.keys(jsonData);

                keys.forEach((key, index) => {
                    // Create a dynamic h2 title for each item
                    const h2 = document.createElement('h2');
                    h2.textContent = `Medidor #${index + 1}: ${key}`;
                    contentDiv.appendChild(h2);

                    // Extract the most recent reading
                    const readings = jsonData[key];
                    const latestReadingKey = Object.keys(readings).pop();
                    const latestReading = readings[latestReadingKey];

                    // Create a table to display the data
                    const table = document.createElement('table');
                    const headers = ["Current A", "Current B", "Current C", "Date", "PF", "Power", "Time", "VAR", "Voltage AN", "Voltage BN", "Voltage CN"];
                    const headerRow = document.createElement('tr');

                    headers.forEach(header => {
                        const th = document.createElement('th');
                        th.textContent = header;
                        headerRow.appendChild(th);
                    });

                    table.appendChild(headerRow);

                    // Create the row of values
                    const valueRow = document.createElement('tr');
                    headers.forEach(header => {
                        const td = document.createElement('td');
                        td.textContent = latestReading[header];
                        valueRow.appendChild(td);
                    });

                    table.appendChild(valueRow);
                    contentDiv.appendChild(table);
                });
            })
            .catch(error => console.error('Error al cargar los datos de Firebase:', error));
        });
    </script>
</body>
</html>